name: Debug terminal

on:
  workflow_dispatch:

jobs:
  debug_session:
    runs-on: ubuntu-24.04
    steps:
      - name: Initialize Environment
        run: |
          sudo -E apt-get -qq update
          sudo -E apt-get -qq install -y build-essential clang flex bison g++ gawk \
          gcc-multilib g++-multilib gettext git libncurses5-dev libssl-dev \
          python3-setuptools rsync swig unzip zlib1g-dev file wget qemu-utils
          sudo timedatectl set-timezone "Asia/Shanghai"

      - name: Checkout Code
        uses: actions/checkout@v5

      - name: Setup Feeds
        working-directory: /home/runner/work/BoltWrt/BoltWrt
        run: |
          ./scripts/feeds update -a
          ./scripts/feeds install -a

          # 修改 LuCI 默认主题路径
          sed -i "s#/luci-static/bootstrap#/luci-static/argon#" feeds/luci/modules/luci-base/root/etc/config/luci

          # 修正 luci-nginx 集合包的依赖
          sed -i -E "s/[[:space:]]*\+luci-theme-bootstrap//" feeds/luci/collections/luci-nginx/Makefile

          mv config.txt .config

      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3
